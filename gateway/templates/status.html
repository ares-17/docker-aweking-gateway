<!DOCTYPE html>
<html class="dark" lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Docker Awakening Gateway — Status Dashboard</title>
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link
        href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap"
        rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#2b75ee",
                        "bg-dark": "#0d1117",
                        "bg-light": "#f8fafc",
                        "card-dark": "#161b22",
                        "card-light": "#ffffff",
                        "border-dark": "#30363d",
                        "border-light": "#e2e8f0",
                        "status-running": "#238636",
                        "status-error": "#da3633",
                        "status-stopped": "#8b949e",
                        "status-starting": "#d29922",
                        "status-awakening": "#2b75ee",
                    },
                    fontFamily: {
                        "display": ["Space Grotesk", "sans-serif"],
                        "mono": ["JetBrains Mono", "monospace"],
                    },
                },
            },
        }
    </script>
    <style>
        @keyframes pulse-dot {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.4;
            }
        }

        .animate-pulse-dot {
            animation: pulse-dot 1.5s ease-in-out infinite;
        }

        @keyframes bar-enter {
            from {
                transform: scaleY(0);
            }

            to {
                transform: scaleY(1);
            }
        }

        .bar-animate {
            animation: bar-enter 0.3s ease-out forwards;
            transform-origin: bottom;
        }

        @keyframes spin-icon {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        .animate-spin-slow {
            animation: spin-icon 1.5s linear infinite;
        }

        /* Dark mode scrollbar */
        .dark ::-webkit-scrollbar {
            width: 4px;
        }

        .dark ::-webkit-scrollbar-track {
            background: transparent;
        }

        .dark ::-webkit-scrollbar-thumb {
            background: #30363d;
            border-radius: 2px;
        }

        /* Simple Icons: invert to white in dark mode, keep dark in light mode */
        .dark .si-icon {
            filter: brightness(0) invert(1);
        }

        .si-icon {
            filter: brightness(0);
        }
    </style>
</head>

<body
    class="dark:bg-bg-dark bg-bg-light dark:text-slate-300 text-slate-700 font-display min-h-screen flex flex-col transition-colors duration-200">

    <!-- ─── Inline SVG definitions (replaces Material Symbols font) ──── -->
    <svg xmlns="http://www.w3.org/2000/svg" class="hidden">
        <symbol id="icon-container" viewBox="0 -960 960 960">
            <path
                d="M440-183v-274L200-596v274l240 139Zm80 0 240-139v-274L520-457v274Zm-40-343 237-137-237-137-237 137 237 137ZM160-252q-19-11-29.5-29T120-321v-318q0-22 10.5-40t29.5-29l280-161q19-11 40-11t40 11l280 161q19 11 29.5 29t10.5 40v318q0 22-10.5 40T800-252L520-91q-19 11-40 11t-40-11L160-252Z" />
        </symbol>
        <symbol id="icon-refresh" viewBox="0 -960 960 960">
            <path
                d="M480-160q-134 0-227-93t-93-227q0-134 93-227t227-93q69 0 132 28.5T720-690v-110h80v280H520v-80h168q-32-56-87.5-88T480-720q-100 0-170 70t-70 170q0 100 70 170t170 70q77 0 139-44t87-116h84q-28 106-114 173t-196 67Z" />
        </symbol>
        <symbol id="icon-dark-mode" viewBox="0 -960 960 960">
            <path
                d="M480-120q-150 0-255-105T120-480q0-150 105-255t255-105q14 0 27.5 1t26.5 3q-41 29-65.5 75.5T444-660q0 90 63 153t153 63q55 0 101-24.5t75-65.5q2 13 3 26.5t1 27.5q0 150-105 255T480-120Z" />
        </symbol>
        <symbol id="icon-light-mode" viewBox="0 -960 960 960">
            <path
                d="M480-360q50 0 85-35t35-85q0-50-35-85t-85-35q-50 0-85 35t-35 85q0 50 35 85t85 35Zm0 80q-83 0-141.5-58.5T280-480q0-83 58.5-141.5T480-680q83 0 141.5 58.5T680-480q0 83-58.5 141.5T480-280ZM200-440H40v-80h160v80Zm720 0H760v-80h160v80ZM440-760v-160h80v160h-80Zm0 720v-160h80v160h-80ZM256-650l-101-97 57-59 96 100-52 56Zm492 496-97-101 53-55 101 97-57 59Zm-98-550 97-101 59 57-100 96-56-52ZM154-212l101-97 55 53-97 101-59-57Z" />
        </symbol>
        <symbol id="icon-lan" viewBox="0 -960 960 960">
            <path
                d="M200-120q-33 0-56.5-23.5T120-200v-160q0-33 23.5-56.5T200-440h80v-80H200q-33 0-56.5-23.5T120-600v-160q0-33 23.5-56.5T200-840h560q33 0 56.5 23.5T840-760v160q0 33-23.5 56.5T760-520H440v80h80q33 0 56.5 23.5T600-360v160q0 33-23.5 56.5T520-120H200Zm0-80h320v-160H200v160Zm0-320h560v-160H200v160Z" />
        </symbol>
        <symbol id="icon-hub" viewBox="0 -960 960 960">
            <path
                d="M480-80q-33 0-56.5-23.5T400-160q0-21 11-39t29-29v-92q-18-11-29-29t-11-39v-52l-164 92q4 8 4 18 0 33-23.5 56.5T160-250q-33 0-56.5-23.5T80-330q0-33 23.5-56.5T160-410q13 0 24 4l172-96-172-96q-11 4-24 4-33 0-56.5-23.5T80-674q0-33 23.5-56.5T160-754q33 0 56.5 23.5T240-674q0 10-4 18l164 92v-52q0-21 11-39t29-29v-92q-18-11-29-29t-11-39q0-33 23.5-56.5T480-924q33 0 56.5 23.5T560-844q0 21-11 39t-29 29v92q18 11 29 29t11 39v52l164-92q-4-8-4-18 0-33 23.5-56.5T800-754q33 0 56.5 23.5T880-674q0 33-23.5 56.5T800-594q-13 0-24-4L604-502l172 96q11-4 24-4 33 0 56.5 23.5T880-330q0 33-23.5 56.5T800-250q-33 0-56.5-23.5T720-330q0-10 4-18l-164-92v52q0 21-11 39t-29 29v92q18 11 29 29t11 39q0 33-23.5 56.5T480-80Z" />
        </symbol>
        <symbol id="icon-play" viewBox="0 -960 960 960">
            <path d="M320-200v-560l440 280-440 280Z" />
        </symbol>
        <symbol id="icon-sync" viewBox="0 -960 960 960">
            <path
                d="M160-160v-80h110l-16-14q-52-46-73-105t-21-119q0-111 66.5-197.5T400-790v84q-72 26-116 88.5T240-478q0 45 17 87.5t53 78.5l10 10v-98h80v240H160Zm400-10v-84q72-26 116-88.5T720-482q0-45-17-87.5T650-648l-10-10v98h-80v-240h240v80H690l16 14q49 49 71.5 106.5T800-482q0 111-66.5 197.5T560-170Z" />
        </symbol>
        <symbol id="icon-alert" viewBox="0 -960 960 960">
            <path
                d="M480-280q17 0 28.5-11.5T520-320q0-17-11.5-28.5T480-360q-17 0-28.5 11.5T440-320q0 17 11.5 28.5T480-280Zm-40-160h80v-240h-80v240ZM330-120 120-330v-300l210-210h300l210 210v300L630-120H330Z" />
        </symbol>
    </svg>

    <!-- Fallback Docker SVG (used when Simple Icons fails to load) -->
    <template id="fallback-docker-svg">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-5 h-5 si-icon">
            <path
                d="M13.983 11.078h2.119a.186.186 0 00.186-.185V9.006a.186.186 0 00-.186-.186h-2.119a.186.186 0 00-.185.185v1.888c0 .102.083.185.185.185m-2.954-5.43h2.118a.186.186 0 00.186-.186V3.574a.186.186 0 00-.186-.185h-2.118a.186.186 0 00-.185.185v1.888c0 .102.082.185.185.186m0 2.716h2.118a.187.187 0 00.186-.186V6.29a.186.186 0 00-.186-.185h-2.118a.186.186 0 00-.185.185v1.887c0 .102.082.185.185.186m-2.93 0h2.12a.186.186 0 00.184-.186V6.29a.185.185 0 00-.185-.185H8.1a.186.186 0 00-.185.185v1.887c0 .102.083.186.185.186m-2.964 0h2.119a.186.186 0 00.185-.186V6.29a.186.186 0 00-.185-.185H5.136a.186.186 0 00-.186.185v1.887c0 .102.084.186.186.186m5.893 2.715h2.118a.186.186 0 00.186-.185V9.006a.186.186 0 00-.186-.186h-2.118a.185.185 0 00-.185.185v1.888c0 .102.082.185.185.185m-2.93 0h2.12a.185.185 0 00.184-.185V9.006a.185.185 0 00-.184-.186h-2.12a.185.185 0 00-.184.185v1.888c0 .102.083.185.185.185m-2.964 0h2.119a.186.186 0 00.185-.185V9.006a.186.186 0 00-.185-.186H5.136a.186.186 0 00-.186.185v1.888c0 .102.084.185.186.185m-2.92 0h2.12a.185.185 0 00.184-.185V9.006a.185.185 0 00-.184-.186h-2.12a.186.186 0 00-.186.186v1.887c0 .102.084.185.186.185M23.763 9.89c-.065-.051-.672-.51-1.954-.51-.338.001-.676.03-1.01.087-.248-1.7-1.653-2.53-1.716-2.566l-.344-.199-.226.327c-.284.438-.49.922-.612 1.43-.23.97-.09 1.882.403 2.661-.595.332-1.55.413-1.744.42H.751a.751.751 0 00-.75.748 11.376 11.376 0 00.692 4.062c.545 1.428 1.355 2.48 2.41 3.124 1.18.723 3.1 1.137 5.275 1.137.983.003 1.963-.086 2.93-.266a12.248 12.248 0 003.823-1.389c.98-.567 1.86-1.288 2.61-2.136 1.252-1.418 1.998-2.997 2.553-4.4h.221c1.372 0 2.215-.549 2.68-1.009.309-.293.55-.65.707-1.046l.098-.288Z" />
        </svg>
    </template>

    <!-- ─── Header ──────────────────────────────────────────────────────── -->
    <header
        class="border-b dark:border-border-dark border-border-light dark:bg-card-dark bg-card-light px-4 sm:px-6 py-4 sticky top-0 z-50 transition-colors duration-200">
        <div class="max-w-7xl mx-auto flex flex-col md:flex-row items-center justify-between gap-4">

            <!-- Logo + title -->
            <div class="flex items-center gap-3">
                <div class="bg-primary/20 p-2 rounded-lg text-primary">
                    <svg class="w-6 h-6" fill="currentColor">
                        <use href="#icon-container" />
                    </svg>
                </div>
                <div>
                    <h1 class="dark:text-white text-slate-900 text-xl font-bold tracking-tight">Docker Awakening
                        Gateway
                    </h1>
                    <p class="text-xs dark:text-slate-500 text-slate-400 font-mono">v{{ .Version }} • /_status</p>
                </div>
            </div>

            <!-- Summary badges -->
            <div id="summary-badges"
                class="flex items-center gap-2 dark:bg-bg-dark/50 bg-slate-100 p-1.5 rounded-lg dark:border-border-dark border-border-light border overflow-x-auto max-w-full">
                <div
                    class="flex items-center gap-2 px-3 py-1 rounded dark:bg-card-dark bg-white dark:border-border-dark border-border-light border min-w-fit">
                    <span class="w-2 h-2 rounded-full bg-slate-400"></span>
                    <span id="badge-total" class="text-xs font-bold dark:text-white text-slate-800 font-mono">0
                        Total</span>
                </div>
                <div
                    class="flex items-center gap-2 px-3 py-1 rounded dark:bg-card-dark bg-white dark:border-border-dark border-border-light border min-w-fit">
                    <span class="w-2 h-2 rounded-full bg-status-running"></span>
                    <span id="badge-running" class="text-xs font-bold text-status-running font-mono">0 Running</span>
                </div>
                <div
                    class="flex items-center gap-2 px-3 py-1 rounded dark:bg-card-dark bg-white dark:border-border-dark border-border-light border min-w-fit">
                    <span class="w-2 h-2 rounded-full bg-status-stopped"></span>
                    <span id="badge-stopped" class="text-xs font-bold text-status-stopped font-mono">0 Stopped</span>
                </div>
            </div>

            <!-- Actions -->
            <div class="flex items-center gap-3">
                <div class="hidden lg:flex flex-col items-end text-xs dark:text-slate-500 text-slate-400 font-mono">
                    <span>Last Updated</span>
                    <span id="last-updated" class="dark:text-slate-300 text-slate-600">--:--:--</span>
                </div>
                <button id="btn-refresh" onclick="fetchStatus()"
                    class="p-2 rounded-lg dark:hover:bg-border-dark hover:bg-slate-200 dark:text-slate-400 text-slate-500 hover:text-primary transition-colors"
                    title="Refresh now">
                    <svg class="w-5 h-5" fill="currentColor">
                        <use href="#icon-refresh" />
                    </svg>
                </button>
                <div class="h-6 w-px dark:bg-border-dark bg-border-light"></div>
                <button id="btn-theme" onclick="toggleTheme()"
                    class="p-2 rounded-lg dark:bg-border-dark bg-slate-200 dark:text-white text-slate-700 transition-colors"
                    title="Toggle dark/light mode">
                    <svg id="theme-icon-dark" class="w-5 h-5" fill="currentColor">
                        <use href="#icon-dark-mode" />
                    </svg>
                    <svg id="theme-icon-light" class="w-5 h-5 hidden" fill="currentColor">
                        <use href="#icon-light-mode" />
                    </svg>
                </button>
            </div>

        </div>
    </header>

    <!-- ─── Main content ────────────────────────────────────────────────── -->
    <main class="flex-grow p-4 sm:p-6">
        <div class="max-w-7xl mx-auto">
            <div id="container-grid" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
                <!-- Cards rendered by JS -->
            </div>
            <!-- Empty state -->
            <div id="empty-state" class="hidden text-center py-20">
                <svg class="w-12 h-12 mx-auto dark:text-slate-600 text-slate-300 mb-4" fill="currentColor">
                    <use href="#icon-alert" />
                </svg>
                <p class="font-mono text-sm dark:text-slate-500 text-slate-400">No container data available. Waiting for
                    first update…</p>
            </div>
        </div>
    </main>

    <!-- ─── Footer ──────────────────────────────────────────────────────── -->
    <footer
        class="border-t dark:border-border-dark border-border-light py-4 text-center transition-colors duration-200">
        <p class="font-mono text-[10px] dark:text-slate-600 text-slate-400">
            Docker Awakening Gateway • /_status • v{{ .Version }} &nbsp;•&nbsp; Auto-refresh: 5s
        </p>
    </footer>

    <script>
            (function () {
                const VERSION = {{ printf "%q" .Version }};
        const SI_CDN = 'https://cdn.jsdelivr.net/npm/simple-icons@14/icons/';
        let history = {};
        const MAX_BARS = 30;
        let firstLoad = true;
        // Cache fetched Simple Icons SVGs to avoid re-fetching
        const iconCache = {};

        // ─── Theme toggle ────────────────────────────────────────────────
        function toggleTheme() {
            const html = document.documentElement;
            const isDark = html.classList.contains('dark');
            if (isDark) {
                html.classList.remove('dark');
                localStorage.setItem('dag-theme', 'light');
                document.getElementById('theme-icon-dark').classList.add('hidden');
                document.getElementById('theme-icon-light').classList.remove('hidden');
            } else {
                html.classList.add('dark');
                localStorage.setItem('dag-theme', 'dark');
                document.getElementById('theme-icon-dark').classList.remove('hidden');
                document.getElementById('theme-icon-light').classList.add('hidden');
            }
        }
        window.toggleTheme = toggleTheme;

        // Restore theme from localStorage
        (function restoreTheme() {
            const saved = localStorage.getItem('dag-theme');
            if (saved === 'light') {
                document.documentElement.classList.remove('dark');
                document.getElementById('theme-icon-dark').classList.add('hidden');
                document.getElementById('theme-icon-light').classList.remove('hidden');
            }
        })();

        // ─── Simple Icons loader ─────────────────────────────────────────
        // Sanitize slug: only lowercase letters, digits, hyphens
        function sanitizeSlug(slug) {
            return (slug || 'docker').toLowerCase().replace(/[^a-z0-9-]/g, '');
        }

        async function loadSimpleIcon(slug, imgEl) {
            const safe = sanitizeSlug(slug);
            imgEl.alt = safe;
            imgEl.src = SI_CDN + safe + '.svg';
        }

        // ─── Helpers ─────────────────────────────────────────────────────
        function statusColor(status) {
            switch (status) {
                case 'running': return 'status-running';
                case 'starting': return 'status-starting';
                case 'failed': case 'dead': return 'status-error';
                case 'exited': case 'stopped': case 'created': return 'status-stopped';
                default: return 'status-awakening';
            }
        }

        function statusLabel(status, startState) {
            if (startState === 'starting') return 'Awakening';
            if (startState === 'failed') return 'Failed';
            switch (status) {
                case 'running': return 'Running';
                case 'exited': case 'created': return 'Stopped';
                case 'dead': return 'Dead';
                default: return status.charAt(0).toUpperCase() + status.slice(1);
            }
        }

        function effectiveStatus(c) {
            if (c.start_state === 'starting') return 'starting';
            if (c.start_state === 'failed') return 'failed';
            if (c.status === 'exited' || c.status === 'created') return 'stopped';
            return c.status;
        }

        function formatDuration(ms) {
            if (ms < 0) return '--';
            const s = Math.floor(ms / 1000);
            if (s < 60) return s + 's';
            const m = Math.floor(s / 60);
            if (m < 60) return m + 'm ' + (s % 60) + 's';
            const h = Math.floor(m / 60);
            if (h < 24) return h + 'h ' + (m % 60) + 'm';
            const d = Math.floor(h / 24);
            return d + 'd ' + (h % 24) + 'h';
        }

        function timeAgo(isoString) {
            if (!isoString) return '--';
            const diff = Date.now() - new Date(isoString).getTime();
            if (diff < 5000) return 'Now';
            return formatDuration(diff) + ' ago';
        }

        function formatTimeout(durationStr) {
            if (!durationStr || durationStr === '0s') return 'disabled';
            return durationStr;
        }

        // ─── Heartbeat bars ──────────────────────────────────────────────
        function recordHistory(name, status) {
            if (!history[name]) history[name] = [];
            history[name].push({ status, ts: Date.now() });
            if (history[name].length > MAX_BARS) {
                history[name] = history[name].slice(-MAX_BARS);
            }
        }

        function barColor(status) {
            switch (status) {
                case 'running': return 'bg-status-running';
                case 'starting': return 'bg-status-starting';
                case 'failed': case 'dead': return 'bg-status-error';
                case 'stopped': case 'exited': case 'created': return 'bg-status-stopped/30';
                default: return 'bg-status-awakening';
            }
        }

        function barHeight(status) {
            switch (status) {
                case 'running': return 'h-full';
                case 'starting': return 'h-3/4';
                case 'failed': case 'dead': return 'h-1/2';
                case 'stopped': case 'exited': case 'created': return 'h-1/4';
                default: return 'h-3/4';
            }
        }

        function renderBars(name) {
            const bars = history[name] || [];
            let html = '';
            const padCount = MAX_BARS - bars.length;
            for (let i = 0; i < padCount; i++) {
                html += '<div class="flex-1 min-w-[3px] max-w-[6px] bg-status-stopped/10 h-1/4 rounded-[1px]"></div>';
            }
            bars.forEach((b, idx) => {
                const delay = firstLoad ? 'animation-delay:' + (idx * 15) + 'ms;' : '';
                const animClass = firstLoad ? 'bar-animate' : '';
                html += '<div class="flex-1 min-w-[3px] max-w-[6px] ' + barColor(b.status) + ' ' + barHeight(b.status) + ' rounded-[1px] ' + animClass + '" style="' + delay + '" title="' + new Date(b.ts).toLocaleTimeString() + ' — ' + b.status + '"></div>';
            });
            return html;
        }

        // ─── Escape HTML to prevent XSS ──────────────────────────────────
        function esc(s) {
            const d = document.createElement('div');
            d.textContent = s;
            return d.innerHTML;
        }

        // ─── Card rendering ──────────────────────────────────────────────
        function renderCard(c) {
            const eff = effectiveStatus(c);
            const color = statusColor(eff);
            const label = statusLabel(c.status, c.start_state);
            const isStarting = c.start_state === 'starting';
            const isStopped = eff === 'stopped';
            const isFailed = eff === 'failed';
            const opacity = isStopped ? 'opacity-75 hover:opacity-100' : '';
            const borderExtra = isFailed ? 'dark:border-status-error/40 border-status-error/30' : isStarting ? 'dark:border-primary/40 border-primary/30' : '';

            // Uptime
            let uptime = '--';
            if (c.started_at && c.status === 'running') {
                uptime = formatDuration(Date.now() - new Date(c.started_at).getTime());
            }

            // Last request
            const lastReq = timeAgo(c.last_request);

            // Sanitize icon slug for Safe usage in attribute
            const safeIcon = sanitizeSlug(c.icon);
            const iconId = 'si-' + esc(c.name).replace(/[^a-zA-Z0-9]/g, '-');

            // Wake button
            const wakeBtn = isStopped
                ? '<button onclick="wakeContainer(\'' + esc(c.name) + '\')" class="px-2.5 py-1 rounded text-[10px] font-bold font-mono uppercase tracking-wider dark:bg-primary/10 bg-primary/5 text-primary dark:border-primary/20 border-primary/20 border hover:bg-primary/20 transition-colors flex items-center gap-1"><svg class="w-3 h-3" fill="currentColor"><use href="#icon-play"/></svg>Wake</button>'
                : '';

            // Status indicator
            const startingIcon = isStarting
                ? '<svg class="w-3 h-3 animate-spin-slow" fill="currentColor"><use href="#icon-sync"/></svg>'
                : '<span class="w-1.5 h-1.5 rounded-full bg-' + color + (isStarting ? ' animate-pulse-dot' : '') + '"></span>';

            return '<div class="group dark:bg-card-dark bg-card-light dark:border-border-dark border-border-light border rounded-xl p-5 hover:dark:border-slate-600 hover:border-slate-300 transition-colors shadow-lg dark:shadow-black/20 shadow-slate-200/50 flex flex-col ' + opacity + ' ' + borderExtra + '">'
                // Header
                + '<div class="flex justify-between items-start mb-4">'
                + '<div class="flex items-center gap-3 ' + (isStopped ? 'dark:grayscale-[30%]' : '') + '">'
                + '<div class="w-10 h-10 rounded-lg dark:bg-primary/10 bg-primary/5 flex items-center justify-center dark:border-primary/20 border-primary/10 border">'
                + '<img id="' + iconId + '" src="' + SI_CDN + safeIcon + '.svg" alt="' + esc(c.name) + '" crossorigin="anonymous" class="w-5 h-5 si-icon" onerror="this.onerror=null;this.style.display=\'none\';this.parentElement.innerHTML=\'<svg class=&quot;w-5 h-5 si-icon&quot; viewBox=&quot;0 -960 960 960&quot; fill=&quot;currentColor&quot;><use href=&quot;#icon-container&quot;/></svg>\'">'
                + '</div>'
                + '<div>'
                + '<h3 class="dark:text-white text-slate-800 font-mono font-bold text-sm tracking-wide">' + esc(c.name) + '</h3>'
                + '<p class="text-xs dark:text-slate-500 text-slate-400 font-mono truncate max-w-[180px]">' + esc(c.image) + '</p>'
                + '</div>'
                + '</div>'
                + '<span class="px-2.5 py-1 rounded-full text-[10px] font-bold uppercase tracking-wider bg-' + color + '/10 text-' + color + ' border border-' + color + '/20 flex items-center gap-1.5 whitespace-nowrap">'
                + startingIcon + label
                + '</span>'
                + '</div>'
                // Heartbeat bars
                + '<div class="mb-5">'
                + '<div class="flex justify-between text-[10px] dark:text-slate-500 text-slate-400 font-mono mb-1.5">'
                + '<span>' + (MAX_BARS * 5) + 's ago</span>'
                + '<span>now</span>'
                + '</div>'
                + '<div class="flex gap-[2px] h-8 items-end">'
                + renderBars(c.name)
                + '</div>'
                + '</div>'
                // Metrics
                + '<div class="grid grid-cols-3 gap-2 mb-5">'
                + '<div class="dark:bg-bg-dark/50 bg-slate-50 rounded p-2 dark:border-border-dark border-border-light border">'
                + '<p class="text-[10px] dark:text-slate-500 text-slate-400 uppercase font-mono mb-1">Uptime</p>'
                + '<p class="dark:text-white text-slate-700 font-mono font-medium text-sm">' + uptime + '</p>'
                + '</div>'
                + '<div class="dark:bg-bg-dark/50 bg-slate-50 rounded p-2 dark:border-border-dark border-border-light border">'
                + '<p class="text-[10px] dark:text-slate-500 text-slate-400 uppercase font-mono mb-1">Last Req</p>'
                + '<p class="dark:text-white text-slate-700 font-mono font-medium text-sm">' + lastReq + '</p>'
                + '</div>'
                + '<div class="dark:bg-bg-dark/50 bg-slate-50 rounded p-2 dark:border-border-dark border-border-light border">'
                + '<p class="text-[10px] dark:text-slate-500 text-slate-400 uppercase font-mono mb-1">Idle T/O</p>'
                + '<p class="dark:text-white text-slate-700 font-mono font-medium text-sm">' + formatTimeout(c.idle_timeout) + '</p>'
                + '</div>'
                + '</div>'
                // Footer
                + '<div class="mt-auto border-t dark:border-border-dark border-border-light pt-3 flex justify-between items-center">'
                + '<div class="flex items-center gap-4 text-xs dark:text-slate-500 text-slate-400 font-mono">'
                + '<span class="flex items-center gap-1"><svg class="w-3.5 h-3.5" fill="currentColor"><use href="#icon-lan"/></svg> :' + esc(c.target_port) + '</span>'
                + (c.network ? '<span class="flex items-center gap-1"><svg class="w-3.5 h-3.5" fill="currentColor"><use href="#icon-hub"/></svg> ' + esc(c.network) + '</span>' : '')
                + '</div>'
                + wakeBtn
                + '</div>'
                + '</div>';
        }

        // ─── Fetch & update ──────────────────────────────────────────────
        async function fetchStatus() {
            try {
                const r = await fetch('/_status/api');
                if (!r.ok) return;
                const data = await r.json();

                // Update timestamp
                const ts = new Date(data.updated_at);
                document.getElementById('last-updated').textContent = ts.toLocaleTimeString();

                const containers = data.containers || [];

                // Summary badges
                const total = containers.length;
                const running = containers.filter(c => c.status === 'running').length;
                const stopped = total - running;
                document.getElementById('badge-total').textContent = total + ' Total';
                document.getElementById('badge-running').textContent = running + ' Running';
                document.getElementById('badge-stopped').textContent = stopped + ' Stopped';

                // Record history for each container
                containers.forEach(c => {
                    recordHistory(c.name, effectiveStatus(c));
                });

                // Render cards
                const grid = document.getElementById('container-grid');
                const emptyState = document.getElementById('empty-state');
                if (containers.length === 0) {
                    grid.classList.add('hidden');
                    emptyState.classList.remove('hidden');
                    return;
                }
                grid.classList.remove('hidden');
                emptyState.classList.add('hidden');
                grid.innerHTML = containers.map(renderCard).join('');
                firstLoad = false;
            } catch (e) {
                console.error('Status fetch failed:', e);
            }
        }
        window.fetchStatus = fetchStatus;

        // ─── Wake container ──────────────────────────────────────────────
        async function wakeContainer(name) {
            try {
                await fetch('/_status/wake?container=' + encodeURIComponent(name), { method: 'POST' });
                setTimeout(fetchStatus, 500);
            } catch (e) {
                console.error('Wake failed:', e);
            }
        }
        window.wakeContainer = wakeContainer;

        // Start polling
        fetchStatus();
        setInterval(fetchStatus, 5000);
        }) ();
    </script>

</body>

</html>